<div class="min-h-screen bg-gray-100 py-8">
  <div class="max-w-4xl mx-auto px-4">

    <!-- Loading -->
    @if (loading()) {
      <div class="flex justify-center items-center py-20">
        <div class="flex items-center gap-3 text-gray-500">
          <svg class="animate-spin h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span class="text-xl">Cargando información de pago...</span>
        </div>
      </div>
    }

    @if (!loading() && reserva()) {
      <!-- Título -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4">
          <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
          </svg>
        </div>
        <h1 class="text-3xl font-serif text-slate-800">Procesar Pago</h1>
        <p class="text-gray-500 mt-2">Complete los datos de su tarjeta para finalizar la reserva</p>
      </div>

      <!-- Mensaje de error -->
      @if (errorMessage()) {
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <p class="text-red-700">{{ errorMessage() }}</p>
        </div>
      }

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <!-- Columna izquierda: Formulario de pago -->
        <div>
          <!-- Tipo de pago -->
          <div class="bg-white border border-gray-200 rounded-lg mb-6">
            <div class="px-4 py-3 border-b border-gray-200">
              <h2 class="text-lg font-medium text-gray-800">Método de Pago</h2>
            </div>
            <div class="p-4">
              <div class="flex gap-4">
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="radio" [formControl]="pagoForm.controls.tipoPago" value="tarjeta" class="w-4 h-4 text-indigo-600">
                  <span class="text-gray-700">Tarjeta de Crédito/Débito</span>
                </label>
              </div>
              
              <!-- Iconos de tarjetas -->
              <div class="flex gap-3 mt-4">
                <div class="w-12 h-8 bg-indigo-600 rounded flex items-center justify-center text-white text-xs font-bold">VISA</div>
                <div class="w-12 h-8 bg-red-500 rounded flex items-center justify-center text-white text-xs font-bold">MC</div>
                <div class="w-12 h-8 bg-indigo-800 rounded flex items-center justify-center text-white text-xs font-bold">AMEX</div>
              </div>
            </div>
          </div>

          <!-- Datos de la tarjeta -->
          <div class="bg-white border border-gray-200 rounded-lg">
            <div class="px-4 py-3 border-b border-gray-200">
              <h2 class="text-lg font-medium text-gray-800">Datos de la Tarjeta</h2>
            </div>
            <div class="p-4 space-y-4">
              
              <!-- Número de tarjeta -->
              <div>
                <label class="block text-sm text-gray-600 mb-1">Número de Tarjeta</label>
                <div class="relative">
                  <input 
                    type="text" 
                    [formControl]="pagoForm.controls.numeroTarjeta"
                    (input)="formatCardNumber($event)"
                    maxlength="16"
                    placeholder="1234 5678 9012 3456"
                    class="w-full px-3 py-3 pl-12 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    [class.border-red-500]="numeroTarjetaInvalid"
                    [class.border-gray-300]="!numeroTarjetaInvalid"
                  />
                  <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                  </svg>
                </div>
                @if (numeroTarjetaInvalid) {
                  <p class="mt-1 text-sm text-red-500">Ingrese un número de tarjeta válido (16 dígitos)</p>
                }
              </div>

              <!-- Nombre del titular -->
              <div>
                <label class="block text-sm text-gray-600 mb-1">Nombre del Titular</label>
                <input 
                  type="text" 
                  [formControl]="pagoForm.controls.nombreTitular"
                  placeholder="Como aparece en la tarjeta"
                  class="w-full px-3 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 uppercase"
                  [class.border-red-500]="nombreTitularInvalid"
                  [class.border-gray-300]="!nombreTitularInvalid"
                />
                @if (nombreTitularInvalid) {
                  <p class="mt-1 text-sm text-red-500">Ingrese el nombre del titular</p>
                }
              </div>

              <!-- Fecha y CVV -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm text-gray-600 mb-1">Fecha de Expiración</label>
                  <input 
                    type="text" 
                    [formControl]="pagoForm.controls.fechaExpiracion"
                    (input)="formatExpiration($event)"
                    maxlength="5"
                    placeholder="MM/AA"
                    class="w-full px-3 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    [class.border-red-500]="fechaExpiracionInvalid"
                    [class.border-gray-300]="!fechaExpiracionInvalid"
                  />
                  @if (fechaExpiracionInvalid) {
                    <p class="mt-1 text-sm text-red-500">Formato: MM/AA</p>
                  }
                </div>
                <div>
                  <label class="block text-sm text-gray-600 mb-1">CVV</label>
                  <input 
                    type="password" 
                    [formControl]="pagoForm.controls.cvv"
                    maxlength="4"
                    placeholder="***"
                    class="w-full px-3 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    [class.border-red-500]="cvvInvalid"
                    [class.border-gray-300]="!cvvInvalid"
                  />
                  @if (cvvInvalid) {
                    <p class="mt-1 text-sm text-red-500">CVV inválido</p>
                  }
                </div>
              </div>

            </div>
          </div>

          <!-- Seguridad -->
          <div class="mt-4 flex items-center gap-2 text-sm text-gray-500">
            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
            </svg>
            <span>Pago seguro con encriptación SSL</span>
          </div>

        </div>

        <!-- Columna derecha: Resumen -->
        <div>
          <div class="bg-white border border-gray-200 rounded-lg sticky top-8">
            <div class="px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-lg">
              <h2 class="text-lg font-medium text-gray-800">Resumen de la Reserva</h2>
            </div>
            <div class="p-4 space-y-4">

              <!-- Hotel -->
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0">
                  <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                  </svg>
                </div>
                <div>
                  <p class="font-medium text-gray-800">{{ reserva()?.hotel?.nombre }}</p>
                  <p class="text-sm text-gray-500">{{ reserva()?.hotel?.direccion }}</p>
                </div>
              </div>

              <hr class="border-gray-200">

              <!-- Fechas -->
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <p class="text-gray-500">Check-in</p>
                  <p class="font-medium text-gray-800">{{ reserva()?.fechaInicio }}</p>
                </div>
                <div>
                  <p class="text-gray-500">Check-out</p>
                  <p class="font-medium text-gray-800">{{ reserva()?.fechaFin }}</p>
                </div>
              </div>

              <hr class="border-gray-200">

              <!-- Cliente -->
              <div class="text-sm">
                <p class="text-gray-500">Huésped</p>
                <p class="font-medium text-gray-800">{{ reserva()?.cliente?.nombre }} {{ reserva()?.cliente?.apellido }}</p>
                <p class="text-gray-500">DNI: {{ reserva()?.cliente?.documento }}</p>
              </div>

              <hr class="border-gray-200">

              <!-- Habitaciones -->
              <div>
                <p class="text-sm text-gray-500 mb-2">Habitaciones</p>
                @for (detalle of reserva()?.detalles; track detalle.id) {
                  <div class="flex justify-between text-sm py-1">
                    <span class="text-gray-700">Habitación #{{ detalle.habitacionId }}</span>
                    <span class="font-medium">{{ formatCurrency(detalle.precioNoche) }}/noche</span>
                  </div>
                }
              </div>

              <hr class="border-gray-200">

              <!-- Total -->
              <div class="flex justify-between items-center pt-2">
                <span class="text-lg font-semibold text-gray-800">Total a Pagar</span>
                <span class="text-2xl font-bold text-indigo-600">{{ formatCurrency(total()) }}</span>
              </div>

              <!-- Botón Pagar -->
              <button 
                type="button"
                (click)="procesarPago()"
                [disabled]="procesando()"
                class="w-full py-4 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed mt-4"
              >
                @if (procesando()) {
                  <span class="flex items-center justify-center gap-2">
                    <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Procesando pago...
                  </span>
                } @else {
                  <span class="flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                    Pagar {{ formatCurrency(total()) }}
                  </span>
                }
              </button>

            </div>
          </div>
        </div>

      </div>

      <!-- Link volver -->
      <div class="mt-8 text-center">
        <a routerLink="/home" class="text-indigo-600 hover:text-indigo-800 transition">
          ← Cancelar y volver al inicio
        </a>
      </div>

    }

  </div>
</div>
